import Head from 'next/head'
import * as React from "react"
import Image from 'next/image'
import styles from '../styles/Home.module.css'
import firebase from "firebase/compat/app"
import "firebase/compat/database"
import {Firebase} from "../src/firebase";

export default function Home() {

    type Estados = "limpo" | "sujo" | "ocupado";

    interface Banco {
        nome: string,
        estado: Estados
    }

    const options = ["limpo", "sujo", "ocupado"];

    const [salas, setSalas] =
        React.useState<Array<Banco>>(new Array(10)
            .fill(0)
            .map((_, index) => ({nome: (200 + index + 1) + "", estado: "limpo"})))

    const transformObjectInArray = (obj) => {
        let arr = []
        for (let key in obj)
            arr.push(obj[key])
        return arr;
    }

    React.useEffect(() => {
        // setToDatabase(Firebase).then(() => alert("finalizado"));
        Firebase.database().ref().child("/salas").on("value", (snap) => {
            if (snap.exists()) {
                setSalas(transformObjectInArray(snap.val()))
            }
        })
    }, []);
    return (
        <div className={styles.container}>
            <Head>
                <title>Create Next App</title>
                <meta name="description" content="Generated by create next app"/>
                <link rel="icon" href="/favicon.ico"/>
            </Head>
            <table>
                <thead>
                <th>Sala</th>
                <th>Estado</th>
                </thead>
                <tbody>
                {salas.map(sala => (<tr key={sala.nome}>
                    <td>{sala.nome}</td>
                    <td>
                        <form>
                            <select onChange={e => {
                                const value = e.target.value;
                                Firebase
                                    .database()
                                    .ref("/salas/"+sala.nome)
                                    .update({estado: value})
                            }}>
                                {
                                    options
                                        .map((option, i) =>
                                            (<option
                                                selected={option === sala.estado}
                                                key={i}>
                                                {option}
                                            </option>))
                                }
                            </select>
                        </form>
                    </td>
                </tr>))}
                </tbody>
            </table>
        </div>
    )
}
